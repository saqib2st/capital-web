<!DOCTYPE html>
<html lang="en">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const opportunityId = urlParams.get("id");
    
            const appStoreURL = "https://apps.apple.com/app/YOUR-APP-ID";  
            const playStoreURL = "https://play.google.com/store/apps/details?id=YOUR-APP-ID"; 
            const deepLink = `capitalconnect://RootNavView/OpportunityDetails?id=${opportunityId || ""}`;
    
            const isAndroid = /Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            let deepLinkAttempted = false;
    
            function openAppOrRedirect() {
                if (deepLinkAttempted) {
                    console.log("Deep link already attempted. Preventing infinite loop.");
                    return;
                }
                deepLinkAttempted = true;
    
                if (isIOS) {
                    console.log("Trying iOS deep link:", deepLink);
                    window.location.href = deepLink;
                    setTimeout(() => {
                        console.log("iOS Deep link failed, redirecting to App Store...");
                        window.location.href = appStoreURL;
                    }, 2500);
                } else if (isAndroid) {
                    console.log("Trying Android deep link with intent...");
                    window.location.href = `intent://RootNavView/OpportunityDetails?id=${opportunityId || ""}#Intent;scheme=capitalconnect;package=com.capital.connect.app;S.browser_fallback_url=${encodeURIComponent(playStoreURL)};end;`;
                    setTimeout(() => {
                        console.log("Android Deep link failed, redirecting to Play Store...");
                        window.location.href = playStoreURL;
                    }, 2500);
                } else {
                    console.log("Neither Android nor iOS, redirecting to store...");
                    window.location.href = playStoreURL;
                }
            }
    
            // ✅ Fetch Metadata Separately
            function fetchMetadata() {
                if (!opportunityId) return;
    
                console.log("Fetching metadata for ID:", opportunityId);
                fetch(`/api/meta?id=${opportunityId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log("Metadata received:", data);
                        document.title = data.title || "Capital Connect";
                        document.querySelector('meta[property="og:title"]').setAttribute("content", data.title || "Capital Connect");
                        document.querySelector('meta[property="og:description"]').setAttribute("content", data.description || "Explore new opportunities.");
                        document.querySelector('meta[property="og:image"]').setAttribute("content", data.image || "https://capital-web-puce.vercel.app/assets/imgs/logo.png");
                        document.querySelector('meta[property="og:url"]').setAttribute("content", window.location.href);
                    })
                    .catch(error => console.error("Error fetching metadata:", error));
            }
    
            // ✅ Execute Both Functions
            fetchMetadata();
            setTimeout(openAppOrRedirect, 500);
        });
    </script>
    
        
<body data-spy="scroll" data-target=".navbar" data-offset="40" id="home">

    <!-- Page Navbar -->
    <nav class="custom-navbar" data-spy="affix" data-offset-top="20">
        <div class="container">
            <a class="logo" href="#">CAPITAL</a>         
            <ul class="nav">
                <li class="item"><a class="link" href="#home">Home</a></li>
                <li class="item"><a class="link" href="#about">About</a></li>
                <li class="item"><a class="link" href="#portfolio">Portfolio</a></li>
                <li class="item"><a class="link" href="#testmonial">Testimonial</a></li>
                <li class="item"><a class="link" href="#blog">Blog</a></li>
                <li class="item"><a class="link" href="#contact">Contact</a></li>
            </ul>
            <a href="javascript:void(0)" id="nav-toggle" class="hamburger hamburger--elastic">
                <div class="hamburger-box">
                  <div class="hamburger-inner"></div>
                </div>
            </a>
        </div>          
    </nav><!-- End of Page Navbar -->

    <!-- Page Header -->
    <header id="home" class="header">
        <div class="overlay"></div>
        <div class="header-content container"> 
            <h1 class="header-title"><span class="up">Capital Connect</span></h1>
            <p class="header-subtitle">Your gateway to personal and professional opportunities in Brussels.</p>            
        </div>
    </header><!-- End of Page Header --> 
	
    <!-- Core Scripts -->
    <script src="assets/vendors/jquery/jquery-3.4.1.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.bundle.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.affix.js"></script>
    <script src="assets/js/meyawo.js"></script>
	
</body>
</html>
