<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Your gateway to unique opportunities for growth and development">
    <meta name="author" content="B-Wyz">
    <title>Capital Connect</title>

    <!-- Default Meta Tags (Will be replaced dynamically) -->
    <meta property="og:title" content="Capital Connect">
    <meta property="og:description" content="Your gateway to personal and professional opportunities in Brussels.">
    <meta property="og:image" content="https://capital-web-puce.vercel.app/assets/imgs/logo.png">
    <meta property="og:url" content="https://capital-web-puce.vercel.app">
    <meta property="og:type" content="website">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Capital Connect">
    <meta name="twitter:description" content="Your gateway to personal and professional opportunities in Brussels.">
    <meta name="twitter:image" content="https://capital-web-puce.vercel.app/assets/imgs/logo.png">

    <!-- JavaScript -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Extract the opportunityId from URL
            const urlParams = new URLSearchParams(window.location.search);
            const opportunityId = urlParams.get("id");

            // Define Deep Links
            var appStoreURL = "https://apps.apple.com/app/6742452533"; // Replace with actual App Store URL
            var playStoreURL = "https://play.google.com/store/apps/details?id=com.capital.connect.app"; // Replace with actual Play Store URL
            var deepLink = `capitalconnect://RootNavView/OpportunityDetails?id=${opportunityId || ""}`; // Dynamically include ID

            // Device Detection
            var isAndroid = /Android/i.test(navigator.userAgent);
            var isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

            // Function to Open App or Redirect
            function openAppOrRedirect() {
                if (isIOS) {
                    window.location.href = deepLink;
                    setTimeout(function () {
                        window.location.href = appStoreURL;
                    }, 2000);
                } else if (isAndroid) {
                    window.location.href = `intent://RootNavView/OpportunityDetails?id=${opportunityId || ""}#Intent;scheme=capitalconnect;package=com.capital.connect.app;S.browser_fallback_url=${encodeURIComponent(playStoreURL)};end;`;
                } else {
                    window.location.href = "https://capital-web-puce.vercel.app/";
                }
            }

            // Fetch Metadata Dynamically
            if (opportunityId) {
                fetch(`/api/meta?id=${opportunityId}`)
                    .then(response => response.json())
                    .then(data => {
                        document.title = data.title;
                        document.querySelector('meta[property="og:title"]').setAttribute("content", data.title);
                        document.querySelector('meta[property="og:description"]').setAttribute("content", data.description);
                        document.querySelector('meta[property="og:image"]').setAttribute("content", data.image);
                        document.querySelector('meta[property="og:url"]').setAttribute("content", window.location.href);

                        // Only redirect after metadata is updated
                        openAppOrRedirect();
                    })
                    .catch(error => {
                        console.error("Error fetching metadata:", error);
                        openAppOrRedirect(); // Fallback if metadata fetch fails
                    });
            } else {
                openAppOrRedirect();
            }
        });
    </script>
</head>
<body data-spy="scroll" data-target=".navbar" data-offset="40" id="home">

    <!-- Page Navbar -->
    <nav class="custom-navbar" data-spy="affix" data-offset-top="20">
        <div class="container">
            <a class="logo" href="#">CAPITAL</a>         
            <ul class="nav">
                <li class="item"><a class="link" href="#home">Home</a></li>
                <li class="item"><a class="link" href="#about">About</a></li>
                <li class="item"><a class="link" href="#portfolio">Portfolio</a></li>
                <li class="item"><a class="link" href="#testmonial">Testimonial</a></li>
                <li class="item"><a class="link" href="#blog">Blog</a></li>
                <li class="item"><a class="link" href="#contact">Contact</a></li>
                <li class="item ml-md-3"><a href="components.html" class="btn btn-primary">Components</a></li>
            </ul>
            <a href="javascript:void(0)" id="nav-toggle" class="hamburger hamburger--elastic">
                <div class="hamburger-box">
                  <div class="hamburger-inner"></div>
                </div>
            </a>
        </div>          
    </nav><!-- End of Page Navbar -->

    <!-- Page Header -->
    <header id="home" class="header">
        <div class="overlay"></div>
        <div class="header-content container"> 
            <h1 class="header-title"><span class="up">Capital Connect</span></h1>
            <p class="header-subtitle">Your gateway to personal and professional opportunities in Brussels.</p>            
        </div>
    </header><!-- End of Page Header --> 
	
    <!-- Core Scripts -->
    <script src="assets/vendors/jquery/jquery-3.4.1.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.bundle.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.affix.js"></script>
	
</body>
</html>
