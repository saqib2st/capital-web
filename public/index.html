<!DOCTYPE html>
<html lang="en">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            const opportunityId = urlParams.get("id");
    
            var appStoreURL = "https://apps.apple.com/app/YOUR-APP-ID";  
            var playStoreURL = "https://play.google.com/store/apps/details?id=YOUR-APP-ID"; 
            var deepLink = `capitalconnect://RootNavView/OpportunityDetails?id=${opportunityId || ""}`;
    
            var isAndroid = /Android/i.test(navigator.userAgent);
            var isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    
            function openAppOrRedirect() {
                if (sessionStorage.getItem("deepLinkAttempted")) {
                    console.log("Deep link already attempted. Preventing infinite loop.");
                    return;
                }
                sessionStorage.setItem("deepLinkAttempted", "true");
    
                if (opportunityId) {
                    fetch(`/api/meta?id=${opportunityId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.redirectUrl) {
                                window.location.href = data.redirectUrl;
                            }
                            document.title = data.title || "Capital Connect";
                            document.querySelector('meta[property="og:title"]').setAttribute("content", data.title || "Capital Connect");
                            document.querySelector('meta[property="og:description"]').setAttribute("content", data.description || "Explore new opportunities.");
                            document.querySelector('meta[property="og:image"]').setAttribute("content", data.image || "https://capital-web-puce.vercel.app/assets/imgs/logo.png");
                            document.querySelector('meta[property="og:url"]').setAttribute("content", window.location.href);
                        })
                        .catch(error => console.error("Error fetching metadata:", error));
                }
    
                if (isIOS) {
                    window.location.href = deepLink;
                    setTimeout(() => {
                        window.location.href = appStoreURL;
                    }, 2000);
                } else if (isAndroid) {
                    window.location.href = `intent://RootNavView/OpportunityDetails?id=${opportunityId || ""}#Intent;scheme=capitalconnect;package=com.capital.connect.app;S.browser_fallback_url=${encodeURIComponent(playStoreURL)};end;`;
                } else {
                    window.location.href = playStoreURL;
                }
            }
    
            openAppOrRedirect();
        });
    </script>
        
<body data-spy="scroll" data-target=".navbar" data-offset="40" id="home">

    <!-- Page Navbar -->
    <nav class="custom-navbar" data-spy="affix" data-offset-top="20">
        <div class="container">
            <a class="logo" href="#">CAPITAL</a>         
            <ul class="nav">
                <li class="item"><a class="link" href="#home">Home</a></li>
                <li class="item"><a class="link" href="#about">About</a></li>
                <li class="item"><a class="link" href="#portfolio">Portfolio</a></li>
                <li class="item"><a class="link" href="#testmonial">Testimonial</a></li>
                <li class="item"><a class="link" href="#blog">Blog</a></li>
                <li class="item"><a class="link" href="#contact">Contact</a></li>
            </ul>
            <a href="javascript:void(0)" id="nav-toggle" class="hamburger hamburger--elastic">
                <div class="hamburger-box">
                  <div class="hamburger-inner"></div>
                </div>
            </a>
        </div>          
    </nav><!-- End of Page Navbar -->

    <!-- Page Header -->
    <header id="home" class="header">
        <div class="overlay"></div>
        <div class="header-content container"> 
            <h1 class="header-title"><span class="up">Capital Connect</span></h1>
            <p class="header-subtitle">Your gateway to personal and professional opportunities in Brussels.</p>            
        </div>
    </header><!-- End of Page Header --> 
	
    <!-- Core Scripts -->
    <script src="assets/vendors/jquery/jquery-3.4.1.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.bundle.js"></script>
    <script src="assets/vendors/bootstrap/bootstrap.affix.js"></script>
    <script src="assets/js/meyawo.js"></script>
	
</body>
</html>
